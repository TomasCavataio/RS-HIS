<div class="create-form-container">
    <!-- Template Driven Forms -->
    <form #createUser="ngForm" (ngSubmit)="buildUser(userForm, addressForm, medicalForm)">
        <mat-horizontal-stepper #stepper>
            <mat-step [stepControl]="userForm">
                <form [formGroup]="userForm">
                    <ng-template matStepLabel>Personal Information</ng-template>
                    <div class="row">
                        <mat-form-field appearance=" fill">
                            <mat-label>Name</mat-label>
                            <input matInput formControlName="name" #name required autocomplete="off" autofocus>
                            <mat-error
                                *ngIf="userForm.controls['name'].invalid && (userForm.controls['name'].dirty || userForm.controls['name'].touched)">
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance=" fill">
                            <mat-label>Surname</mat-label>
                            <input matInput formControlName="surname" #surname required autocomplete="off">
                            <mat-error
                                *ngIf="userForm.controls['surname'].invalid && (userForm.controls['surname'].dirty || userForm.controls['surname'].touched)">
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance=" fill">
                            <mat-label>Second Surname </mat-label>
                            <input matInput formControlName="secondSurname" #secondSurname autocomplete="off">
                        </mat-form-field>

                        <mat-form-field appearance=" fill">
                            <mat-label>Gender</mat-label>
                            <mat-select formControlName="gender" #gender>
                                <mat-option value="'Male'">Male</mat-option>
                                <mat-option value="'Female'">Female</mat-option>
                                <mat-option value="'Other'">Other</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="row">
                        <mat-form-field appearance=" fill">
                            <mat-label>Birth Date</mat-label>
                            <input formControlName="birthday" matInput [matDatepicker]="birthday">
                            <mat-datepicker-toggle matSuffix [for]="birthday"></mat-datepicker-toggle>
                            <mat-datepicker #birthday></mat-datepicker>
                        </mat-form-field>

                        <mat-form-field appearance=" fill">
                            <mat-label>User Type</mat-label>
                            <mat-select [(value)]="pacient" #userType formControlName="userType"
                                (selectionChange)="verifyUser()" required>
                                <mat-option value="pacient">Pacient</mat-option>
                                <mat-option value="professional">Professional</mat-option>
                            </mat-select>
                        </mat-form-field>

                        <mat-form-field *ngIf="!isPacient" appearance=" fill">
                            <mat-label>Professional Type</mat-label>
                            <mat-select formControlName="professionalType" #professionalType required>
                                <mat-option value='Doctor'>Doctor</mat-option>
                                <mat-option value='Nurse'>Nurse</mat-option>
                                <mat-option value='Administrative'>Administrative</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div>
                    </div>
                </form>
            </mat-step>
            <mat-step>
                <form [formGroup]="addressForm">
                    <ng-template matStepperIcon="location_on" matStepLabel>Address Information</ng-template>
                    <div class="row">
                        <mat-form-field appearance=" fill">
                            <mat-label>City</mat-label>
                            <input formControlName="city" matInput #city autocomplete="off">
                        </mat-form-field>

                        <mat-form-field appearance=" fill">
                            <mat-label>Postal Code</mat-label>
                            <input formControlName="postalCode" matInput #postalCode autocomplete="off">
                        </mat-form-field>

                        <mat-form-field appearance=" fill">
                            <mat-label>Street</mat-label>
                            <input formControlName="street" matInput #street autocomplete="off">
                        </mat-form-field>
                    </div>
                    <div class="row">
                        <mat-form-field appearance=" fill">
                            <mat-label>Street Number</mat-label>
                            <input formControlName="streetNumber" matInput #streetNumber autocomplete="off">
                        </mat-form-field>

                        <mat-form-field appearance=" fill">
                            <mat-label>Door Number/Letter</mat-label>
                            <input formControlName="doorNumber" matInput #doorNumber autocomplete="off">
                        </mat-form-field>
                    </div>
                    <div>
                    </div>
                </form>
            </mat-step>
            <mat-step [stepControl]="medicalForm">
                <form [formGroup]="medicalForm">
                    <ng-template matStepLabel>Medical & Insurance Information</ng-template>
                    <div class="row">
                        <mat-form-field *ngIf="!isPacient" appearance=" fill">
                            <mat-label>Medical Board Number</mat-label>
                            <input matInput #medicalBoardNumber formControlName="medicalBoardNumber" autocomplete="off"
                                [required]="!isPacient">
                        </mat-form-field>

                        <mat-form-field *ngIf="isPacient" appearance=" fill">
                            <mat-label>NHC</mat-label>
                            <input matInput #nhc formControlName="nhc" autocomplete="off" [required]="isPacient">
                        </mat-form-field>

                        <mat-form-field *ngIf="isPacient" appearance=" fill">
                            <mat-label>Insurance Company</mat-label>
                            <input matInput formControlName="insuranceCompanyName" #insuranceCompanyName
                                autocomplete="off">
                        </mat-form-field>

                        <mat-form-field appearance=" fill">
                            <mat-label>NIF</mat-label>
                            <input formControlName="nif" matInput #nif autocomplete="off">
                        </mat-form-field>

                    </div>
                    <div class="row">
                        <mat-form-field *ngIf="isPacient" appearance=" fill">
                            <mat-label>Card Number</mat-label>
                            <input formControlName="cardNumber" matInput #cardNumber autocomplete="off">
                        </mat-form-field>

                        <mat-form-field *ngIf="isPacient" appearance=" fill">
                            <mat-label>Insurance Type</mat-label>
                            <mat-select formControlName="insuranceType" #insuranceType required>
                                <mat-option value='Health'>Health</mat-option>
                                <mat-option value='Family'>Family</mat-option>
                                <mat-option value='Dental'>Dental</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div>
                    </div>
                </form>
            </mat-step>
            <mat-step [stepControl]="(userForm && medicalForm)">
                <ng-template matStepLabel>Done</ng-template>
                <h2 class="doneMessage"
                    [hidden]="userForm.pristine || userForm.invalid || ((medicalForm.controls.nhc.pristine || medicalForm.controls.nhc.invalid) && (medicalForm.controls.medicalBoardNumber.pristine || medicalForm.controls.medicalBoardNumber.invalid))">
                    You are now done.</h2>
                <div>
                    <button mat-raised-button
                        [disabled]="userForm.pristine || userForm.invalid || ((medicalForm.controls.nhc.pristine || medicalForm.controls.nhc.invalid) && (medicalForm.controls.medicalBoardNumber.pristine || medicalForm.controls.medicalBoardNumber.invalid))"
                        color="primary" type="submit">Create User</button>
                </div>
            </mat-step>
        </mat-horizontal-stepper>

        <br>
        <br>

        <button mat-raised-button color="warn" type="submit" [routerLink]="'../'">Cancel</button>
    </form>
</div>